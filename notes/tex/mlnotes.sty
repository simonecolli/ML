% mlnotes.sty
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{mlnotes}[Custom style for ML notes]

\RequirePackage[utf8]{inputenc}
\RequirePackage[T1]{fontenc}
\RequirePackage{amsmath, amssymb, amsthm}
\RequirePackage{graphicx}
\RequirePackage[italian]{babel}

% --- Pacchetti TColorBox e Librerie (caricati una sola volta) ---
\RequirePackage[most]{tcolorbox}
\tcbuselibrary{theorems}
\tcbuselibrary{breakable}
% -----------------------------------------------------------------

\RequirePackage{xcolor}
\definecolor{cs@theorem}{HTML}{0366d6}
\definecolor{cs@proposition}{HTML}{02AFD6}
\definecolor{cs@exercise}{HTML}{895ED8}
\definecolor{cs@example}{HTML}{22863a}
\definecolor{cs@definition}{HTML}{d73a49}
\definecolor{cs@note}{HTML}{fcd2b6}

% --- Pacchetti per Layout e Stile ---
\RequirePackage{titlesec}
\newcommand{\sectionbreak}{\clearpage}

\RequirePackage[left=3cm, right=3cm]{geometry}
\RequirePackage{fancyhdr}
\RequirePackage[colorlinks=true, linkcolor=blue, citecolor=blue, urlcolor=blue]{hyperref}
\RequirePackage[italian]{cleveref}
\RequirePackage{booktabs}
\RequirePackage{todonotes}

% --- Impostazione Intestazione e Pi√® di Pagina ---
\renewcommand{\sectionmark}[1]{\markright{\thesection.\ #1}}
\renewcommand{\subsectionmark}[1]{\markright{\thesubsection.\ #1}}

\fancypagestyle{fancy}{%
    \fancyhf{} % Clear header and footer
    \fancyhead[L]{\slshape Introduzione al Machine Learning}
    \fancyhead[R]{\slshape \rightmark}
    \fancyfoot[C]{\thepage}
    \renewcommand{\headrulewidth}{0.4pt}
    \renewcommand{\footrulewidth}{0.4pt}
}

\fancypagestyle{plain}{%
    \fancyhf{}
    \fancyfoot[C]{\thepage}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}
}
\pagestyle{fancy}

% --- Ambienti Personalizzati (versione pulita) ---
\newtcbtheorem[number within=section]{teorema}{Teorema}%
{colback=cs@theorem!5, colframe=cs@theorem, fonttitle=\bfseries\sffamily, coltitle=white!90!cs@theorem, breakable
}{thm}

\newtcbtheorem[number within=section]{dimostrazione}{Dimostrazione}%
{enhanced, colback=gray!5, colframe=gray!20, fonttitle=\bfseries\sffamily, coltitle=black!80, breakable, sharp corners, boxrule=0.5mm, colbacktitle=gray!20,
overlay unbroken and last={\node[anchor=south east, font=\small, text=black] at (frame.south east) {$\square$};}}{dem}

\newtcbtheorem[number within=section]{proposizione}{Proposizione}%
{enhanced, colback=cs@proposition!5, colframe=cs@proposition, fonttitle=\bfseries\sffamily, coltitle=white!90!cs@proposition, breakable
}{prop}

\newtcbtheorem[number within=section]{definizione}{Definizione}%
{enhanced, colback=cs@definition!5, colframe=cs@definition, fonttitle=\bfseries\sffamily, coltitle=white!90!cs@definition, breakable
}{def}

\newtcbtheorem[number within=section]{esempio}{Esempio}%
{enhanced, colback=cs@example!10, colframe=cs@example, fonttitle=\bfseries\sffamily, coltitle=white!90!cs@example, breakable, boxrule=0pt
}{ex}

\newtcbtheorem[number within=section]{esercizio}{Esercizio}%
{enhanced, colback=cs@exercise!5, colframe=cs@exercise, fonttitle=\bfseries\sffamily, coltitle=white, breakable
}{exr}

\newtcbtheorem[number within=section]{nota}{Nota}%
{enhanced, colback=cs@note!15, colframe=cs@note, fonttitle=\bfseries\sffamily, coltitle=black!60!cs@note, breakable, boxrule=0pt}{nt}

% --- Definizioni per Cleveref ---
\crefname{tcb@cnt@teorema}{teorema}{teoremi}
\crefname{tcb@cnt@proposizione}{proposizione}{proposizioni}
\crefname{tcb@cnt@definizione}{definizione}{definizioni}
\crefname{tcb@cnt@esempio}{esempio}{esempi}
\crefname{tcb@cnt@esercizio}{esercizio}{esercizi}
\crefname{tcb@cnt@nota}{nota}{note}
\crefname{tcb@cnt@dimostrazione}{dimostrazione}{dimostrazioni}

\Crefname{tcb@cnt@teorema}{Teorema}{Teoremi}
\Crefname{tcb@cnt@proposizione}{Proposizione}{Proposizioni}
\Crefname{tcb@cnt@definizione}{Definizione}{Definizioni}
\Crefname{tcb@cnt@esempio}{Esempio}{Esempi}
\Crefname{tcb@cnt@esercizio}{Esercizio}{Esercizi}
\Crefname{tcb@cnt@nota}{Nota}{Note}
\Crefname{tcb@cnt@dimostrazione}{Dimostrazione}{Dimostrazioni}

% --- Informazioni Documento ---
\providecommand{\authorname}{Manuel Di Agostino, Simone Colli}
\providecommand{\authoremail}{manuel.diagostino@studenti.unipr.it, simone.colli@studenti.unipr.it}
\providecommand{\coursecode}{000}
\providecommand{\coursetitle}{Corso}
\providecommand{\notedate}{\today}

\author{\authorname \\ \texttt{\authoremail}}
\title{\coursetitle{}}
\date{\notedate}
